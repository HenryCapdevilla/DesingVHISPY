<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style_History.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <title>Historial</title>
</head>
<body>
    <div class="Menu">
        <a href="index.html">
            <img id="menu_bar" src="Icons/lista.png" alt="Menú">
        </a>
        <img id="logo" src="Icons/Logo.png" alt="Menú">
    </div>
    <div class="container">
        <div class="fecha-bloque">
            <label for="fecha-inicial">
                <h1>
                    Fecha Inicial
                </h1>
            </label>
            <input type="date" id="fecha-inicial">
        </div>
        <div class="fecha-bloque">
            <label for="fecha-final">
                <h1>
                    Fecha Final
                </h1>
            </label>
            <input type="date" id="fecha-final">
        </div>
    </div>
    <div class="container-map">
        <div id="map" class="map" style="height: 100%;"></div>
    </div>
    <script>
        var fechaInicial = document.getElementById("fecha-inicial");
        var fechaFinal = document.getElementById("fecha-final");
        var fechaMinFinal = ""; // Variable para almacenar la fecha mínima permitida en fecha final

        fechaInicial.addEventListener('change', function() {
            // Obtener la fecha seleccionada en el bloque de fecha inicial
            var fechaSeleccionada = new Date(fechaInicial.value);
            
            // Calcular la fecha mínima permitida para la fecha final (al día siguiente de la seleccionada)
            fechaSeleccionada.setDate(fechaSeleccionada.getDate() + 1);
            fechaMinFinal = fechaSeleccionada.toISOString().split('T')[0];
            
            // Actualizar la propiedad min del bloque de fecha final
            fechaFinal.min = fechaMinFinal;
            
            // Resetear el valor de la fecha final si es anterior a la fecha mínima permitida
            if (fechaFinal.value < fechaMinFinal) {
                fechaFinal.value = fechaMinFinal;
            }
        });

        function mostrarFechas() {
            var fechaInicialValor = fechaInicial.value;
            var fechaFinalValor = fechaFinal.value;

            // Puedes hacer algo con las fechas, como mostrarlas en la página
            var resultado = "Fecha Inicial: " + fechaInicialValor + "<br>Fecha Final: " + fechaFinalValor;
            document.getElementById("resultado").innerHTML = resultado;
        }

        // Initialize the Leaflet map
        var map = L.map('map').setView([0, 0], 2); // Set initial map center and zoom level
        var maxMarkersToShow = 2; // Show only the first and last markers
        var markers = []; // Array to store markers
        var polylines = []; // Array to store polylines
        var timer; // Timer to clear markers if no new data in 30 seconds
        var centerSet = false; // Flag to check if the center has been set
        
        // Title
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        // Custom Leaflet control to clear the map
        var clearButtonControl = L.Control.extend({
            options: {
                position: 'topright'
            },
            onAdd: function (map) {
                var container = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
                var button = L.DomUtil.create('a', 'leaflet-control-button', container);
                button.href = '#';
                button.title = 'Limpiar Mapa';
                button.innerHTML = ''; // No text inside the button, just the icon
    
                L.DomEvent.on(button, 'click', function () {
                    for (var i = 0; i < polylines.length; i++) {
                    map.removeLayer(polylines[i]);
                }
                polylines = [];
            });
            return container;
            }
        });

        map.addControl(new clearButtonControl());

        // Custom Leaflet control for info tab
        var infoTabControl = L.Control.extend({
            options: {
                position: 'bottomright'
            },
            onAdd: function (map) {
                var container = L.DomUtil.create('div', 'leaflet-control-info');
                container.innerHTML = '<b>Latitud:</b> <span id="latitud"></span><br><b>Longitud:</b> <span id="longitud"></span><br><b>Timestamp:</b> <span id="timestamp"></span>';
                return container;
            }
        });

        var infoTab = new infoTabControl();
        infoTab.addTo(map);

        // Create additional Control placeholders
        function addControlPlaceholders(map) {
            var corners = map._controlCorners,
                l = 'leaflet-',
                container = map._controlContainer;
    
            function createCorner(vSide, hSide) {
                var className = l + vSide + ' ' + l + hSide;
    
                corners[vSide + hSide] = L.DomUtil.create('div', className, container);
            }
    
            createCorner('verticalcenter', 'left');
            createCorner('verticalcenter', 'right');
        }
        addControlPlaceholders(map);
    
        // Change the position of the Zoom Control to a newly created placeholder.
        map.zoomControl.setPosition('bottomright');
    </script>
</body>
</html>
